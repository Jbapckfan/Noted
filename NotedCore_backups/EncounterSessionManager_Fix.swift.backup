// Extension fix for MedicalNoteGenerator
extension MedicalNoteGenerator {
    func generateNote(from transcript: String, type: NoteType, phases: [EncounterPhase]) async -> String {
        // Use the medical summarizer service to generate actual notes
        let summarizerService = ProductionMedicalSummarizerService()
        
        await summarizerService.generateMedicalNote(
            from: transcript,
            noteType: type,
            customInstructions: "",
            encounterID: "",
            phase: phases.first?.type ?? .initial
        )
        
        // Wait for generation to complete with timeout
        var waitCount = 0
        while summarizerService.isGenerating && waitCount < 50 {
            try? await Task.sleep(nanoseconds: 100_000_000) // 0.1 seconds
            waitCount += 1
        }
        
        // Return the generated note or create a basic one if generation failed
        let generatedNote = summarizerService.generatedNote
        
        if !generatedNote.isEmpty && !generatedNote.contains("No medical content") {
            return generatedNote
        } else {
            // Fallback: Create a properly formatted note from the transcript
            let timestamp = DateFormatter.medicalTimestamp.string(from: Date())
            
            switch type {
            case .soap:
                return """
                **SOAP NOTE**
                Generated: \(timestamp)
                
                **SUBJECTIVE:**
                \(transcript)
                
                **OBJECTIVE:**
                [Vitals and physical exam to be added]
                
                **ASSESSMENT:**
                [Clinical assessment to be added]
                
                **PLAN:**
                [Treatment plan to be added]
                """
                
            case .edNote:
                return """
                **EMERGENCY DEPARTMENT NOTE**
                Generated: \(timestamp)
                
                **TRANSCRIPT:**
                \(transcript)
                
                **MEDICAL DECISION MAKING:**
                [To be completed by provider]
                
                **DISPOSITION:**
                [Discharge/admission plan to be added]
                """
                
            default:
                return """
                **MEDICAL NOTE**
                Generated: \(timestamp)
                Type: \(type.displayName)
                
                **ENCOUNTER TRANSCRIPT:**
                \(transcript)
                
                **CLINICAL SUMMARY:**
                [To be generated by AI processing]
                """
            }
        }
    }
}